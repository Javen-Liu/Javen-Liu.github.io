<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JVM 笔记 - 2 类加载子系统 | Into the Matrix</title><meta name="description" content="类加载器与类的加载过程类加载的阶段类加载阶段包括加载（Loading）阶段、链接（Linking）阶段 *和 *初始化（Initialization）阶段，其中链接阶段包含了验证（Verification）、准备（Preparation）、解析（Resolution）   类加载器子系统负责从文件系统或者网络中加载Class文件，class文件在文件开头有特定的文件标识 ClassLoader只负"><meta name="keywords" content="JVM"><meta name="author" content="Javen-Liu"><meta name="copyright" content="Javen-Liu"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/Flickr.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="dns-prefetch" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="1quvJQkaYT3evaaS"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="JVM 笔记 - 2 类加载子系统"><meta name="twitter:description" content="类加载器与类的加载过程类加载的阶段类加载阶段包括加载（Loading）阶段、链接（Linking）阶段 *和 *初始化（Initialization）阶段，其中链接阶段包含了验证（Verification）、准备（Preparation）、解析（Resolution）   类加载器子系统负责从文件系统或者网络中加载Class文件，class文件在文件开头有特定的文件标识 ClassLoader只负"><meta name="twitter:image" content="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png"><meta property="og:type" content="article"><meta property="og:title" content="JVM 笔记 - 2 类加载子系统"><meta property="og:url" content="https://blog.matrix-world.top/2020/07/12/JVM%20-%202.%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F/"><meta property="og:site_name" content="Into the Matrix"><meta property="og:description" content="类加载器与类的加载过程类加载的阶段类加载阶段包括加载（Loading）阶段、链接（Linking）阶段 *和 *初始化（Initialization）阶段，其中链接阶段包含了验证（Verification）、准备（Preparation）、解析（Resolution）   类加载器子系统负责从文件系统或者网络中加载Class文件，class文件在文件开头有特定的文件标识 ClassLoader只负"><meta property="og:image" content="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png"><meta property="article:published_time" content="2020-07-12T06:04:00.000Z"><meta property="article:modified_time" content="2020-07-18T07:37:48.827Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = 'false'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://blog.matrix-world.top/2020/07/12/JVM%20-%202.%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F/"><link rel="prev" title="JVM 笔记 - 3 运行时数据区概述及线程" href="https://blog.matrix-world.top/2020/07/14/JVM%20-%203.%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E6%A6%82%E8%BF%B0%E5%8F%8A%E7%BA%BF%E7%A8%8B/"><link rel="next" title="JVM 笔记 - 1 JVM与Java体系结构" href="https://blog.matrix-world.top/2020/07/10/JVM%20-%201.JVM%E4%B8%8EJava%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?da9e9551b8bd3e9ae9c4cbb811816c40";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: false,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"top-right"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'none',
  isFontAwesomeV5: true,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"><link rel="alternate" href="/atom.xml" title="Into the Matrix" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/dog.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">34</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">23</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">11</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 留言</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#类加载器与类的加载过程"><span class="toc-number">1.</span> <span class="toc-text">类加载器与类的加载过程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#类加载的阶段"><span class="toc-number">1.1.</span> <span class="toc-text">类加载的阶段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#加载（Loading）阶段"><span class="toc-number">1.2.</span> <span class="toc-text">加载（Loading）阶段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#链接（Linking）阶段"><span class="toc-number">1.3.</span> <span class="toc-text">链接（Linking）阶段</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#验证（Verify）"><span class="toc-number">1.3.1.</span> <span class="toc-text">验证（Verify）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#准备（Prepare）"><span class="toc-number">1.3.2.</span> <span class="toc-text">准备（Prepare）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解析（Resolve）"><span class="toc-number">1.3.3.</span> <span class="toc-text">解析（Resolve）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#初始化（Initialization）"><span class="toc-number">1.4.</span> <span class="toc-text">初始化（Initialization）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#类加载器的分类"><span class="toc-number">2.</span> <span class="toc-text">类加载器的分类</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#启动类加载器（引导类加载器，Bootstrap-ClassLoader）"><span class="toc-number">2.1.</span> <span class="toc-text">启动类加载器（引导类加载器，Bootstrap ClassLoader）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#扩展类加载器"><span class="toc-number">2.2.</span> <span class="toc-text">扩展类加载器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用程序加载器（系统类加载器）"><span class="toc-number">2.3.</span> <span class="toc-text">应用程序加载器（系统类加载器）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#用户自定义类加载器"><span class="toc-number">2.4.</span> <span class="toc-text">用户自定义类加载器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#为什么要自定义类加载器？"><span class="toc-number">2.4.1.</span> <span class="toc-text">为什么要自定义类加载器？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#用户自定义类加载器实现步骤："><span class="toc-number">2.4.2.</span> <span class="toc-text">用户自定义类加载器实现步骤：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#双亲委派机制"><span class="toc-number">3.</span> <span class="toc-text">双亲委派机制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#工作原理"><span class="toc-number">3.1.</span> <span class="toc-text">工作原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#为什么用双亲委派？"><span class="toc-number">3.2.</span> <span class="toc-text">为什么用双亲委派？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#其他"><span class="toc-number">4.</span> <span class="toc-text">其他</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#对类的加载器的引用"><span class="toc-number">4.1.</span> <span class="toc-text">对类的加载器的引用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#类的主动使用和被动使用"><span class="toc-number">4.2.</span> <span class="toc-text">类的主动使用和被动使用</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Into the Matrix</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 留言</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">JVM 笔记 - 2 类加载子系统</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-07-12 14:04:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-07-12</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-07-18 15:37:48"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-07-18</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/JVM/">JVM</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="类加载器与类的加载过程"><a href="#类加载器与类的加载过程" class="headerlink" title="类加载器与类的加载过程"></a>类加载器与类的加载过程</h1><h2 id="类加载的阶段"><a href="#类加载的阶段" class="headerlink" title="类加载的阶段"></a>类加载的阶段</h2><p>类加载阶段包括<strong>加载（Loading）阶段</strong>、<strong>链接（Linking）阶段 *<em>和 *</em>初始化（Initialization）阶段</strong>，其中链接阶段包含了<strong>验证（Verification）、准备（Preparation）、解析（Resolution）</strong></p>
<p><img src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/20200716101934.png" alt="类加载阶段"></p>
<ul>
<li>类加载器子系统负责从文件系统或者网络中加载Class文件，class文件在文件开头有特定的文件标识</li>
<li>ClassLoader只负责class文件的加载，至于是否可以运行，则由Execution Engine决定</li>
<li>加载的类信息存放在一块称为 <strong>方法区</strong> 的内存空间。除了类的信息外，方法区中还会有存放运行时常量池信息，还可能包括字符串字面量和数字常量</li>
</ul>
<p>类加载器ClassLoader角色</p>
<p><img src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/20200716101702.png" alt="类加载器的角色"></p>
<h2 id="加载（Loading）阶段"><a href="#加载（Loading）阶段" class="headerlink" title="加载（Loading）阶段"></a>加载（Loading）阶段</h2><p>加载阶段包括：</p>
<ol>
<li>通过一个类的全限定名获取定义此类的二进制字节流</li>
<li>将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构</li>
<li><strong>在内存中生成一个代表这个类的java.lang.Class对象</strong>，作为方法区这个类的各种数据的访问入口</li>
</ol>
<p>加载 .class 文件的方式：</p>
<ul>
<li>从本地系统中直接加载</li>
<li>通过网络获取，典型场景：Web Applet</li>
<li>从zip压缩包中读取，称为日后jar、war格式的基础</li>
<li><strong>运行时计算产生，使用最多的是：动态代理技术</strong></li>
<li>从其他文件生成，典型场景：JSP</li>
<li>从专有数据库中提取 .class 文件，较为少见</li>
<li>从加密文件中获取，典型的防 Class 文件被反编译的保护措施</li>
</ul>
<h2 id="链接（Linking）阶段"><a href="#链接（Linking）阶段" class="headerlink" title="链接（Linking）阶段"></a>链接（Linking）阶段</h2><h3 id="验证（Verify）"><a href="#验证（Verify）" class="headerlink" title="验证（Verify）"></a>验证（Verify）</h3><ul>
<li>目的在于确保Class文件的字节流中包含信息符合当前虚拟机的要求，保证被加载类的正确性，不会危害虚拟机自身安全</li>
<li>主要包括四种验证：文件格式验证，元数据验证，字节码验证，符号应用验证</li>
</ul>
<h3 id="准备（Prepare）"><a href="#准备（Prepare）" class="headerlink" title="准备（Prepare）"></a>准备（Prepare）</h3><ul>
<li>为类变量分配内存并且设置该类变量的默认初始值，即零值</li>
<li><strong>这里不包含用final修饰的static，因为final在编译的时候就会分配了，准备（preparation）阶段会显式初始化</strong></li>
<li><strong>这里不会为实例变量分配初始化</strong>，类变量会分配在方法区，而实例变量是会随着对象一起分配到Java堆中</li>
</ul>
<h3 id="解析（Resolve）"><a href="#解析（Resolve）" class="headerlink" title="解析（Resolve）"></a>解析（Resolve）</h3><ul>
<li>将常量池内的符号应用转化为直接应用的过程</li>
<li>符号引用就是一组符号来描述所引用的目标；直接引用就是直接指向目标的指针</li>
<li><strong>事实上，解析操作往往会伴随着JVM在执行完初始化之后再执行</strong></li>
</ul>
<h2 id="初始化（Initialization）"><a href="#初始化（Initialization）" class="headerlink" title="初始化（Initialization）"></a>初始化（Initialization）</h2><ul>
<li><strong>初始化阶段就是执行类构造器方法 <clinit>( ) 的过程</strong></li>
<li>此方法不需定义，是javac编译器自动收集类中的<strong>所有类变量的赋值动作</strong>和<strong>静态代码块中的语句</strong>合并而来的（<strong>也就是说，如果一个类中，所有类变量都没有赋值，而是在构造器中赋值，那么该类在初始化时，字节码中是没有<clinit>( ) 方法的</strong>）</li>
<li>构造器方法中指令按语句在源文件中出现的顺序执行</li>
<li><strong><clinit>( ) 不同于类的构造器</strong>，区别于<init>( )</li>
<li>若该类具有父类，JVM会保证子类的<clinit>( ) 执行前，父类的<clinit>( )已经执行完毕</li>
<li>虚拟机必须保证一个类的<clinit>( ) 方法在多线程下被同步加锁</li>
</ul>
<h1 id="类加载器的分类"><a href="#类加载器的分类" class="headerlink" title="类加载器的分类"></a>类加载器的分类</h1><ul>
<li>JVM支持两种类型的类加载器，分别为<strong>引导式加载器</strong>（Bootstrap ClassLoader）和<strong>自定义类加载器</strong>（User-Defined ClassLoader）</li>
<li>从概念上讲，自定义类加载器一般指的是程序中有开发人员自定义的一类类加载器，但是Java虚拟机规范并没这么定义，而是<strong>将所有派生于抽象类ClassLoader的类加载器都划分为自定义类加载器</strong>。</li>
</ul>
<p><img src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/20200717155939.png" alt="类加载器"></p>
<blockquote>
<p>这里的四者之间的关系是包含关系，不是上层下层，也不是子父类的继承关系</p>
</blockquote>
<h2 id="启动类加载器（引导类加载器，Bootstrap-ClassLoader）"><a href="#启动类加载器（引导类加载器，Bootstrap-ClassLoader）" class="headerlink" title="启动类加载器（引导类加载器，Bootstrap ClassLoader）"></a>启动类加载器（引导类加载器，Bootstrap ClassLoader）</h2><ul>
<li>该类是通过C/C++语言实现的，嵌套在JVM内部</li>
<li>它用来加载Java的核心类库（JAVA_HOME/jre/lib/rt.jar、resources.jar 或 sum.boot.class.path 路径下的内容），用于提供JVM自身需要的类</li>
<li>并不继承自java.lang.ClassLoader，没有父加载器</li>
<li>启动类加载器也<strong>加载</strong>扩展类和应用程序类加载器，并指定为他们的父类加载器</li>
<li>处于安全考虑，Bootstrap启动类加载器只会加载包名为java、javax、sun等开头的类</li>
</ul>
<h2 id="扩展类加载器"><a href="#扩展类加载器" class="headerlink" title="扩展类加载器"></a>扩展类加载器</h2><ul>
<li>Java语言编写</li>
<li>派生于ClassLoader类</li>
<li>父类加载器为启动类加载器</li>
<li>从 java.ext.dirs 系统属性所指定的目录中加载类库，或从JDK的安装目录的 jre/lib/ext 子目录下加载类库。如果用户创建的JAR放在此目录下，也会自动由扩展类加载器加载。</li>
</ul>
<h2 id="应用程序加载器（系统类加载器）"><a href="#应用程序加载器（系统类加载器）" class="headerlink" title="应用程序加载器（系统类加载器）"></a>应用程序加载器（系统类加载器）</h2><ul>
<li>java语言编写</li>
<li>派生于ClassLoader类</li>
<li>父类加载器为扩展类加载器</li>
<li>负责加载环境变量classpath或系统属性 java.class.path 指定路径下的类库</li>
<li>该类加载是程序中默认的类加载器，一般来说，Java应用的类都是由它来完成加载</li>
<li>通过ClassLoader # getSystemClassLoader()方法可以获取到该类加载器</li>
</ul>
<h2 id="用户自定义类加载器"><a href="#用户自定义类加载器" class="headerlink" title="用户自定义类加载器"></a>用户自定义类加载器</h2><p>在Java的日常开发中，类的加载几乎是由上述3中类加载器相互配合执行的，在必要时，我们还可以自定义类加载器，来定制类的加载方法。</p>
<h3 id="为什么要自定义类加载器？"><a href="#为什么要自定义类加载器？" class="headerlink" title="为什么要自定义类加载器？"></a>为什么要自定义类加载器？</h3><ul>
<li>隔离加载类</li>
<li>修改类加载的方式</li>
<li>扩展加载源</li>
<li>放置源码泄露</li>
</ul>
<h3 id="用户自定义类加载器实现步骤："><a href="#用户自定义类加载器实现步骤：" class="headerlink" title="用户自定义类加载器实现步骤："></a>用户自定义类加载器实现步骤：</h3><ol>
<li>开发人员可以通过集成抽象类 <strong>java.lang.ClassLoader</strong> 类的方式，实现自己的类加载器，以满足一些特殊的需求。</li>
<li>在JDK1.2之前，在自定义类加载器时，总会去集成 ClassLoader 类并重写 loadClass() 方法，从而实现自定义的类加载类，但在JDK1.2之后，官方已经不建议用户去覆盖 loadClass() 方法，而是建议把自定义的类加载逻辑写在 findClass() 方法中。</li>
<li>在编写自定义类加载器时，如果没有太过于复杂的需求，可以直接继承 URLClassLoader 类，这样就避免自己去编写 findClass() 方法以及其获取字节码流的方式，使自定义类加载器编写更加简洁。</li>
</ol>
<h1 id="双亲委派机制"><a href="#双亲委派机制" class="headerlink" title="双亲委派机制"></a>双亲委派机制</h1><h2 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h2><ol>
<li>如果一个类加载器收到了类加载请求，它并不会自己先去加载，而是把这个请求委托给父类的加载器去执行；</li>
<li>如果父类加载器还存在其父类加载器，则进一步向上委托，一次递归，请求最终将达到顶层的启动类加载器；</li>
<li>如果父类加载器可以完成类加载任务，就成功返回，倘若父类加载器无法完成此加载任务，子加载器才会尝试自己去加载，这就是双亲委派机制。</li>
</ol>
<p><img src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/20200717182509.png" alt="双亲委派机制"></p>
<h2 id="为什么用双亲委派？"><a href="#为什么用双亲委派？" class="headerlink" title="为什么用双亲委派？"></a>为什么用双亲委派？</h2><ul>
<li>避免类被重复加载</li>
<li>保护程序安全，防止核心API被恶意篡改</li>
</ul>
<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><ul>
<li>在JVM中表示两个class对象是否为同一个类存在两个必要条件：<ol>
<li>类的完整类名必须一致，包括包名</li>
<li>加载这个类的ClassLoader（指ClassLoader实例对象）必须相同</li>
</ol>
</li>
<li>换句话说，在JVM中，即使这两个类对象（class对象）来源同一个Class文件，被同一个虚拟机所加载，但只要加载他们的CLassLoader实例对象不同，那么这两个类对象也不是相等的</li>
</ul>
<h2 id="对类的加载器的引用"><a href="#对类的加载器的引用" class="headerlink" title="对类的加载器的引用"></a>对类的加载器的引用</h2><p>如果一个类型是由用户类加载器加载的，那么JVM会将这个类加载器的一个引用作为类型信息的一部分保存在方法区内。当解析一个类型到另一个类型的引用的时候，JVM需要保证这两个类型的类加载器是相同的。</p>
<h2 id="类的主动使用和被动使用"><a href="#类的主动使用和被动使用" class="headerlink" title="类的主动使用和被动使用"></a>类的主动使用和被动使用</h2><ul>
<li>主动使用，分为七种情况：<ul>
<li>创建类的实例</li>
<li>访问某个类或接口的静态变量，或者对该静态变量幅值</li>
<li>调用类的静态方法</li>
<li>反射，例如：Class.forName(“com.matrix.xxxx”)</li>
<li>初始化一个类的子类</li>
<li>Java虚拟机启动时被表明为启动类的类</li>
<li>JDK 7 开始提供的动态语言支持</li>
</ul>
</li>
<li>除了以上七种情况，其他使用Java类的方式都被看做是对类的<strong>被动使用</strong>，都<strong>不会导致类的初始化</strong></li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Javen-Liu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://blog.matrix-world.top/2020/07/12/JVM%20-%202.%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F/">https://blog.matrix-world.top/2020/07/12/JVM%20-%202.%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%AD%90%E7%B3%BB%E7%BB%9F/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.matrix-world.top" target="_blank">Into the Matrix</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JVM/">JVM</a><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/07/14/JVM%20-%203.%E8%BF%90%E8%A1%8C%E6%97%B6%E6%95%B0%E6%8D%AE%E5%8C%BA%E6%A6%82%E8%BF%B0%E5%8F%8A%E7%BA%BF%E7%A8%8B/"><img class="prev_cover" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JVM 笔记 - 3 运行时数据区概述及线程</div></div></a></div><div class="next-post pull_right"><a href="/2020/07/10/JVM%20-%201.JVM%E4%B8%8EJava%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/"><img class="next_cover" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JVM 笔记 - 1 JVM与Java体系结构</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/08/10/JVM - 10.对象的实例化内存布局与访问定位/" title="JVM 笔记 - 10 对象的实例化内存布局与访问定位"><img class="relatedPosts_cover" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-08-10</div><div class="relatedPosts_title">JVM 笔记 - 10 对象的实例化内存布局与访问定位</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/10/JVM - 1.JVM与Java体系结构/" title="JVM 笔记 - 1 JVM与Java体系结构"><img class="relatedPosts_cover" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-07-10</div><div class="relatedPosts_title">JVM 笔记 - 1 JVM与Java体系结构</div></div></a></div><div class="relatedPosts_item"><a href="/2020/08/12/JVM - 11.直接内存/" title="JVM 笔记 - 11 直接内存"><img class="relatedPosts_cover" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-08-12</div><div class="relatedPosts_title">JVM 笔记 - 11 直接内存</div></div></a></div><div class="relatedPosts_item"><a href="/2020/08/12/JVM - 12.执行引擎/" title="JVM 笔记 - 12 执行引擎"><img class="relatedPosts_cover" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-08-12</div><div class="relatedPosts_title">JVM 笔记 - 12 执行引擎</div></div></a></div><div class="relatedPosts_item"><a href="/2020/08/15/JVM - 13.StringTable/" title="JVM 笔记 - 13 StringTable"><img class="relatedPosts_cover" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-08-15</div><div class="relatedPosts_title">JVM 笔记 - 13 StringTable</div></div></a></div><div class="relatedPosts_item"><a href="/2020/08/22/JVM - 14.垃圾回收概述/" title="JVM 笔记 - 14 垃圾回收概述"><img class="relatedPosts_cover" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-08-22</div><div class="relatedPosts_title">JVM 笔记 - 14 垃圾回收概述</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail','link'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'BNPpl7rbNHrmJvxCySHpYsoc-gzGzoHsz',
  appKey: 'zUznNRS8dG9TQFJI3lQ181VE',
  notify: false,
  verify: false,
  placeholder: '留下你的足迹吧',
  avatar: 'robohash',
  meta: guestInfo,
  pageSize: '10',
  lang: 'zh-CN',
  recordIP: false,
  serverURLs: '',
  emojiCDN: 'https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/',
  emojiMaps: {"tv_doge":"6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_亲亲":"a8111ad55953ef5e3be3327ef94eb4a39d535d06.png","tv_偷笑":"bb690d4107620f1c15cff29509db529a73aee261.png","tv_再见":"180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_冷漠":"b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_发怒":"34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_发财":"34db290afd2963723c6eb3c4560667db7253a21a.png","tv_可爱":"9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_吐血":"09dd16a7aa59b77baa1155d47484409624470c77.png","tv_呆":"fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png","tv_呕吐":"9f996894a39e282ccf5e66856af49483f81870f3.png","tv_困":"241ee304e44c0af029adceb294399391e4737ef2.png","tv_坏笑":"1f0b87f731a671079842116e0991c91c2c88645a.png","tv_大佬":"093c1e2c490161aca397afc45573c877cdead616.png","tv_大哭":"23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_委屈":"d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_害羞":"a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png","tv_尴尬":"7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png","tv_微笑":"70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_思考":"90cf159733e558137ed20aa04d09964436f618a1.png","tv_惊吓":"0d15c7e2ee58e935adc6a7193ee042388adc22af.png"},
  enableQQ: true,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2021 By Javen-Liu</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Let us make some noise <a href="https://jerryc.me/" target="_blank" rel="noopener">into the Matrix</a>!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">簡</a><i class="darkmode far fa-moon" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script></body></html>