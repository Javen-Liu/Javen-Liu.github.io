<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JVM 笔记 - 12 执行引擎 | Into the Matrix</title><meta name="description" content="执行引擎概述 执行引擎是Java虚拟机核心的组成部分之一 “虚拟机”是一个相对于“物理机”的概念，这两种机器都有代码执行能力，其区别是物理机的执行引擎是直接建立在处理器、缓存、指令集和操作系统层面上的。而虚拟机的执行引擎则是由软件自行实现的，因此可以不受物理条件制约地指定指令集和执行引擎的结构体系，能够执行那些不被硬件直接支持的指令集格式 JVM的主要任务是负责装载字节码到其内部，但字节码并不能直"><meta name="keywords" content="JVM"><meta name="author" content="Javen-Liu"><meta name="copyright" content="Javen-Liu"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/Flickr.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="dns-prefetch" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="baidu-site-verification" content="1quvJQkaYT3evaaS"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="JVM 笔记 - 12 执行引擎"><meta name="twitter:description" content="执行引擎概述 执行引擎是Java虚拟机核心的组成部分之一 “虚拟机”是一个相对于“物理机”的概念，这两种机器都有代码执行能力，其区别是物理机的执行引擎是直接建立在处理器、缓存、指令集和操作系统层面上的。而虚拟机的执行引擎则是由软件自行实现的，因此可以不受物理条件制约地指定指令集和执行引擎的结构体系，能够执行那些不被硬件直接支持的指令集格式 JVM的主要任务是负责装载字节码到其内部，但字节码并不能直"><meta name="twitter:image" content="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png"><meta property="og:type" content="article"><meta property="og:title" content="JVM 笔记 - 12 执行引擎"><meta property="og:url" content="https://javen-liu.github.io/2020/08/12/JVM%20-%2012.%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/"><meta property="og:site_name" content="Into the Matrix"><meta property="og:description" content="执行引擎概述 执行引擎是Java虚拟机核心的组成部分之一 “虚拟机”是一个相对于“物理机”的概念，这两种机器都有代码执行能力，其区别是物理机的执行引擎是直接建立在处理器、缓存、指令集和操作系统层面上的。而虚拟机的执行引擎则是由软件自行实现的，因此可以不受物理条件制约地指定指令集和执行引擎的结构体系，能够执行那些不被硬件直接支持的指令集格式 JVM的主要任务是负责装载字节码到其内部，但字节码并不能直"><meta property="og:image" content="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png"><meta property="article:published_time" content="2020-08-12T02:55:00.000Z"><meta property="article:modified_time" content="2020-08-15T09:22:40.192Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = 'false'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="canonical" href="https://javen-liu.github.io/2020/08/12/JVM%20-%2012.%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/"><link rel="prev" title="JVM 笔记 - 13 StringTable" href="https://javen-liu.github.io/2020/08/15/JVM%20-%2013.StringTable/"><link rel="next" title="JVM 笔记 - 11 直接内存" href="https://javen-liu.github.io/2020/08/12/JVM%20-%2011.%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98/"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?da9e9551b8bd3e9ae9c4cbb811816c40";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: false,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#2d3035","position":"top-right"},
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'none',
  isFontAwesomeV5: true,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: true
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.1"></head><body><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/dog.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">31</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">20</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">10</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 留言</span></a></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#执行引擎概述"><span class="toc-number">1.</span> <span class="toc-text">执行引擎概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Java代码编译和执行过程"><span class="toc-number">2.</span> <span class="toc-text">Java代码编译和执行过程</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#机器码、指令、汇编语言"><span class="toc-number">3.</span> <span class="toc-text">机器码、指令、汇编语言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#机器码"><span class="toc-number">3.1.</span> <span class="toc-text">机器码</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#指令"><span class="toc-number">3.2.</span> <span class="toc-text">指令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#指令集"><span class="toc-number">3.3.</span> <span class="toc-text">指令集</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#汇编语言"><span class="toc-number">3.4.</span> <span class="toc-text">汇编语言</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#解释器"><span class="toc-number">4.</span> <span class="toc-text">解释器</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#JIT编译器"><span class="toc-number">5.</span> <span class="toc-text">JIT编译器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#既然JIT编译器速度很快，那为什么HotSpot仍然还包含解释器呢？"><span class="toc-number">5.1.</span> <span class="toc-text">既然JIT编译器速度很快，那为什么HotSpot仍然还包含解释器呢？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#概念解释"><span class="toc-number">5.2.</span> <span class="toc-text">概念解释</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#热点代码即探测方式"><span class="toc-number">5.3.</span> <span class="toc-text">热点代码即探测方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HotSpot-VM可以设置程序执行方式"><span class="toc-number">5.4.</span> <span class="toc-text">HotSpot VM可以设置程序执行方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HotSpot-VM中JIT分类"><span class="toc-number">5.5.</span> <span class="toc-text">HotSpot VM中JIT分类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C1和C2编译器不同的优化策略"><span class="toc-number">5.6.</span> <span class="toc-text">C1和C2编译器不同的优化策略</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div class="post-bg" id="nav" style="background-image: url(https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">Into the Matrix</a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 留言</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">JVM 笔记 - 12 执行引擎</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2020-08-12 10:55:00"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2020-08-12</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2020-08-15 17:22:40"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2020-08-15</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/JVM/">JVM</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="执行引擎概述"><a href="#执行引擎概述" class="headerlink" title="执行引擎概述"></a>执行引擎概述</h1><ul>
<li>执行引擎是Java虚拟机核心的组成部分之一</li>
<li>“虚拟机”是一个相对于“物理机”的概念，这两种机器都有代码执行能力，其区别是物理机的执行引擎是直接建立在处理器、缓存、指令集和操作系统层面上的。<strong>而虚拟机的执行引擎则是由软件自行实现的，因此可以不受物理条件制约地指定指令集和执行引擎的结构体系，能够执行那些不被硬件直接支持的指令集格式</strong></li>
<li>JVM的主要任务是负责<strong>装载字节码到其内部</strong>，但字节码并不能直接运行在操作系统之上，因为字节码指令并非等价于本地机器指令，它内部包含的仅仅是一些能够被JVM所识别的字节码指令、符号表，以及其他辅助信息</li>
<li>那么想要让一个Java程序运行起来，执行引擎（Execution Engine）的任务就是<strong>将字节码指令解释/编译为对应平台上的本地机器指令才可以</strong>。简单来说，JVM中的执行引擎充当了将高级语言翻译为机器语言的译者。</li>
</ul>
<p><img src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/20200813104449.png" alt=""></p>
<ol>
<li>执行引擎在执行的过程中究竟需要执行什么样的字节码指令完全依赖于PC寄存器</li>
<li>每当执行完一项指令操作后，PC寄存器就会更新下一条需要被执行的指令地址</li>
<li>当然方法在执行的过程中，执行引擎有可能会通过存储在局部变量表中的对象引用准确定位到存储在Java堆区中的对象实例信息，以及通过对象头中的元数据指针定位到目标对象的类型信息</li>
</ol>
<h1 id="Java代码编译和执行过程"><a href="#Java代码编译和执行过程" class="headerlink" title="Java代码编译和执行过程"></a>Java代码编译和执行过程</h1><p>大部分的程序代码转换成物理机的目标代码或虚拟机能执行的指令集之前，都需要经过下图的各个步骤：</p>
<p><img src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/20200813104904.png" alt=""></p>
<p>Java代码编译是由Java源码编译器来完成，流程图如下：</p>
<p><img src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/20200813105243.png" alt=""></p>
<hr>
<p><strong>问题：什么是解释器（interpreter），什么是JIT编译器？</strong></p>
<ul>
<li>解释器：当Java虚拟机启动时，会根据预定义的规范对字节码采用逐行解释的方式执行，将每条字节码文件中的内容“翻译”为对应平台的本地机器指令执行</li>
<li>JIT（Just In Time Compiler）编译器：虚拟机将源代码直接编译成和本地机器平台相关的机器语言</li>
</ul>
<h1 id="机器码、指令、汇编语言"><a href="#机器码、指令、汇编语言" class="headerlink" title="机器码、指令、汇编语言"></a>机器码、指令、汇编语言</h1><h2 id="机器码"><a href="#机器码" class="headerlink" title="机器码"></a>机器码</h2><ul>
<li>各种用二进制编码方式表示的指令，叫做机器指令码。最开始，人们就用它编写程序，这就是机器语言</li>
<li>机器语言虽然能够被计算机理解和接受，但和人们的语言差别太大，不易被人们理解和记忆，并且用它编程容易出错</li>
<li>用它编写的程序一经输入计算机，CPU直接读取运行，因此和其他语言编的程序相比，执行速度最快</li>
<li>机器指令和CPU紧密相关，所以不同种类的CPU所对应的机器指令也就不同</li>
</ul>
<h2 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h2><ul>
<li>由于机器码是由0和1组成的二进制序列，可读性太差，于是人们发明了指令</li>
<li>指令就是把机器码汇总特定的0和1序列，简化成对应的指令（一般为英文缩写，如mov，inc等），可读性稍好</li>
<li>由于不同的硬件平台，执行同一个操作，对应的机器码可能不同，所以不同的硬件平台的同一指令（比如mov），对应的机器码也可能不同</li>
</ul>
<h2 id="指令集"><a href="#指令集" class="headerlink" title="指令集"></a>指令集</h2><ul>
<li>不同的硬件平台，各自支持的指令，是有差别的。因此每个平台所支持的指令，称之为对应平台的指令集</li>
</ul>
<h2 id="汇编语言"><a href="#汇编语言" class="headerlink" title="汇编语言"></a>汇编语言</h2><ul>
<li>由于指令的可读性还是太差，于是人们又发明了汇编语言</li>
<li>在汇编语言中，用<strong>助记符（Mnemonics）代替机器指令的操作码</strong>，用<strong>地址符号（Symbol）或标号（Label）</strong>代替指令或操作数的地址</li>
<li>在不同的硬件平台，汇编语言对应着不同的机器语言指令集，通过汇编过程转换成机器指令</li>
</ul>
<p><img src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/20200813112354.png" alt=""></p>
<h1 id="解释器"><a href="#解释器" class="headerlink" title="解释器"></a>解释器</h1><p>JVM设计者们的初衷仅仅只是单纯地为了<strong>满足Java程序实现跨平台特性</strong>，因此避免采用静态编译的方式直接生成本地机器指令，从而诞生了实现解释器在运行时采用逐行解释字节码执行程序的想法</p>
<ul>
<li>解释器真正意义上所承担的角色就是一个运行时“翻译者”，将字节码文件中的内容“翻译”为对应平台的本地机械指令执行</li>
<li>当一条字节码指令被解释执行完成后，根据PC寄存器中记录的下一条需要被执行的字节码指令操作解释操作</li>
</ul>
<hr>
<p>现状：</p>
<ul>
<li>由于解释器在设计和实现上非常简单，因此除了Java语言之外，还有许多高级语言同样也是基于解释器执行的，比如Python、Perl、Ruby等。但是在今天，<strong>基于解释器执行已经沦落为抵消的代名词</strong>，并且时常被一些C/C++程序员所调侃</li>
<li>为了解决这个问题，JVM平台支持一种叫做即时编译的技术。即时编译的目的是避免函数被解释执行，而是<strong>将整个函数体译成为机器码，每次函数执行时，只执行编译后的机器码即可</strong>，种方式可以使执行效率大幅度提升</li>
<li>不过无论何时，基于解释器的执行模式仍然为中间语言的发展做出了不可磨灭的贡献</li>
</ul>
<h1 id="JIT编译器"><a href="#JIT编译器" class="headerlink" title="JIT编译器"></a>JIT编译器</h1><h2 id="既然JIT编译器速度很快，那为什么HotSpot仍然还包含解释器呢？"><a href="#既然JIT编译器速度很快，那为什么HotSpot仍然还包含解释器呢？" class="headerlink" title="既然JIT编译器速度很快，那为什么HotSpot仍然还包含解释器呢？"></a>既然JIT编译器速度很快，那为什么HotSpot仍然还包含解释器呢？</h2><p>首先明确：</p>
<p>当程序启动后，解释器可以马上发挥作用，省去编译时间，立即执行</p>
<p>而编译器想要发挥作用，把代码编译为本地代码，需要一定的执行时间。但编译为本地代码后，执行效率高</p>
<p>所以当Java虚拟机启动时，计时器可以首先发挥作用，而不必等待即时编译器全部编译完成后再执行，这样可以省去很多不必要的编译时间。随着时间的推移，编译器发挥作用，把越来越多的代码变异成本地代码，获得更高的执行效率</p>
<p>同时，解释执行在编译器进行激进优化不成立时，作为编译器的“逃生门”</p>
<h2 id="概念解释"><a href="#概念解释" class="headerlink" title="概念解释"></a>概念解释</h2><ul>
<li>Java语言的“编译期”其实是一段“不确定”的操作过程，它可能是是指一个<strong>前端编译器</strong>，把.java文件转化为.class文件的过程</li>
<li>也可能是<strong>后端运行期编译器</strong>（JIT编译器），把字节码转化成机器码</li>
<li>害可能是<strong>静态提前编译器</strong>（AOT编译器，Ahead Of Time Compiler）直接把.java文件编译成本地机器代码</li>
</ul>
<h2 id="热点代码即探测方式"><a href="#热点代码即探测方式" class="headerlink" title="热点代码即探测方式"></a>热点代码即探测方式</h2><ul>
<li><strong>一个被多次调用的方法，或者是一个方法体内部循环次数较多的循环体都可以被称之为“热点代码”</strong>，因此都可以通过JIT编译器编译为本地机器指令。由于这种编译方式发生在方法的执行过程中，因此也被称之为栈上替换，简称为OSR（On Stack Replacement）编译</li>
<li>一个方法究竟要被嗲用多少次，或者一个循环体究竟要执行多少次循环才可以达到这个标准？必然需要一个明确的阈值，这里主要依靠热点探测技术</li>
<li>目前HotSpot VM所采用的热点探测方式是基于计数器的热点探测</li>
<li>采用基于计数器的热点探测，HotSpot VM将会为每一个方法都建议2个不同类型的计数器，分别为方法调用计数器（Invocation Counter）和回边计数器（Back Edge Counter）<ul>
<li>方法调用计数器用于统计方法的调用次数</li>
<li>回边计数器则用于统计循环体执行的循环次数</li>
</ul>
</li>
</ul>
<p><img src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/20200813163312.png" alt=""></p>
<h2 id="HotSpot-VM可以设置程序执行方式"><a href="#HotSpot-VM可以设置程序执行方式" class="headerlink" title="HotSpot VM可以设置程序执行方式"></a>HotSpot VM可以设置程序执行方式</h2><p>缺省情况下HotSpot VM是采用解释器与即时编译器并存的架构，当然开发人员可以根据具体的应用场景，通过命令显式地为Java虚拟机指定在运行时到底是<strong>完全采用计时器</strong>执行，还是<strong>完全采用即时编译器</strong>执行，如下：</p>
<ul>
<li>-Xint：完全采用解释器模式执行程序</li>
<li>-Xcomp：完全采用即时编译器模式执行程序。如果即时编译出现问题，解释器会介入执行</li>
<li>-Xmixed：采用解释器+即时编译器的混合模式共同执行程序</li>
</ul>
<h2 id="HotSpot-VM中JIT分类"><a href="#HotSpot-VM中JIT分类" class="headerlink" title="HotSpot VM中JIT分类"></a>HotSpot VM中JIT分类</h2><p>在HotSpot VM中内嵌有两个JIT编译器，分别为Client Compiler和Server Compiler，但大多数情况下我们简称为C1编译器和C2编译器。开发人员可以通过如下命令显式指定Java虚拟机在运行时到达地使用哪一种即时编译器，如下：</p>
<ul>
<li>-client：指定Java虚拟机运行在Client模式，并使用C1编译器；C1编译器会对字节码<strong>进行简单和可靠的优化，耗时短</strong>。以达到更快的编译速度</li>
<li>-server：指定Java虚拟机运行在Server模式，并使用C2编译器；C2编译器进行<strong>耗时较长的优化，以及激进优化</strong>。但优化的代码执行效率更高</li>
</ul>
<h2 id="C1和C2编译器不同的优化策略"><a href="#C1和C2编译器不同的优化策略" class="headerlink" title="C1和C2编译器不同的优化策略"></a>C1和C2编译器不同的优化策略</h2><ul>
<li>不同的编译器上有不同的优化策略，C1编译器上主要有方法内联，去虚拟化，冗余消除<ul>
<li>方法内联：将引用的函数代码编译到引用点处，这样可以减少战争的生成，减少参数传递以及跳转过程</li>
<li>去虚拟化：对唯一的实现类进行内敛</li>
<li>冗余消除：在运行期间把一些不会执行的代码折叠掉</li>
</ul>
</li>
<li>C2的优化主要是在全局层面，逃逸分析是优化的基础。基于逃逸分析在C2上右如下几种优化：<ul>
<li>标量替换：用标量值代替聚合对象的属性值</li>
<li>栈上分配：对于未逃逸的对象分配在栈上而不是堆上</li>
<li>同步消除：清除同步操作，通常是synchronized</li>
</ul>
</li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Javen-Liu</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://javen-liu.github.io/2020/08/12/JVM%20-%2012.%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/">https://javen-liu.github.io/2020/08/12/JVM%20-%2012.%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://javen-liu.github.io" target="_blank">Into the Matrix</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JVM/">JVM</a><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a></div><div class="post_share"><div class="social-share" data-image="https://gitee.com/Javen-Liu/blogimage/raw/master/img/20200826235719_1.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.png" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="prev-post pull_left"><a href="/2020/08/15/JVM%20-%2013.StringTable/"><img class="prev_cover" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">JVM 笔记 - 13 StringTable</div></div></a></div><div class="next-post pull_right"><a href="/2020/08/12/JVM%20-%2011.%E7%9B%B4%E6%8E%A5%E5%86%85%E5%AD%98/"><img class="next_cover" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">JVM 笔记 - 11 直接内存</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/07/10/JVM - 1.JVM与Java体系结构/" title="JVM 笔记 - 1 JVM与Java体系结构"><img class="relatedPosts_cover" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-07-10</div><div class="relatedPosts_title">JVM 笔记 - 1 JVM与Java体系结构</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/12/JVM - 2.类加载子系统/" title="JVM 笔记 - 2 类加载子系统"><img class="relatedPosts_cover" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-07-12</div><div class="relatedPosts_title">JVM 笔记 - 2 类加载子系统</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/16/JVM - 4.程序计数器/" title="JVM 笔记 - 4 程序计数器"><img class="relatedPosts_cover" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-07-16</div><div class="relatedPosts_title">JVM 笔记 - 4 程序计数器</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/14/JVM - 3.运行时数据区概述及线程/" title="JVM 笔记 - 3 运行时数据区概述及线程"><img class="relatedPosts_cover" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-07-14</div><div class="relatedPosts_title">JVM 笔记 - 3 运行时数据区概述及线程</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/20/JVM - 5.虚拟机栈/" title="JVM 笔记 - 5 虚拟机栈"><img class="relatedPosts_cover" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-07-20</div><div class="relatedPosts_title">JVM 笔记 - 5 虚拟机栈</div></div></a></div><div class="relatedPosts_item"><a href="/2020/07/28/JVM - 8.堆/" title="JVM 笔记 - 8 堆"><img class="relatedPosts_cover" src="https://gitee.com/Javen-Liu/blogimage/raw/master/img/2020-7-18-1595057081263.png"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-07-28</div><div class="relatedPosts_title">JVM 笔记 - 8 堆</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail','link'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'BNPpl7rbNHrmJvxCySHpYsoc-gzGzoHsz',
  appKey: 'zUznNRS8dG9TQFJI3lQ181VE',
  notify: false,
  verify: false,
  placeholder: '留下你的足迹吧',
  avatar: 'robohash',
  meta: guestInfo,
  pageSize: '10',
  lang: 'zh-CN',
  recordIP: false,
  serverURLs: '',
  emojiCDN: 'https://img.t.sinajs.cn/t4/appstyle/expression/ext/normal/',
  emojiMaps: {"tv_doge":"6ea59c827c414b4a2955fe79e0f6fd3dcd515e24.png","tv_亲亲":"a8111ad55953ef5e3be3327ef94eb4a39d535d06.png","tv_偷笑":"bb690d4107620f1c15cff29509db529a73aee261.png","tv_再见":"180129b8ea851044ce71caf55cc8ce44bd4a4fc8.png","tv_冷漠":"b9cbc755c2b3ee43be07ca13de84e5b699a3f101.png","tv_发怒":"34ba3cd204d5b05fec70ce08fa9fa0dd612409ff.png","tv_发财":"34db290afd2963723c6eb3c4560667db7253a21a.png","tv_可爱":"9e55fd9b500ac4b96613539f1ce2f9499e314ed9.png","tv_吐血":"09dd16a7aa59b77baa1155d47484409624470c77.png","tv_呆":"fe1179ebaa191569b0d31cecafe7a2cd1c951c9d.png","tv_呕吐":"9f996894a39e282ccf5e66856af49483f81870f3.png","tv_困":"241ee304e44c0af029adceb294399391e4737ef2.png","tv_坏笑":"1f0b87f731a671079842116e0991c91c2c88645a.png","tv_大佬":"093c1e2c490161aca397afc45573c877cdead616.png","tv_大哭":"23269aeb35f99daee28dda129676f6e9ea87934f.png","tv_委屈":"d04dba7b5465779e9755d2ab6f0a897b9b33bb77.png","tv_害羞":"a37683fb5642fa3ddfc7f4e5525fd13e42a2bdb1.png","tv_尴尬":"7cfa62dafc59798a3d3fb262d421eeeff166cfa4.png","tv_微笑":"70dc5c7b56f93eb61bddba11e28fb1d18fddcd4c.png","tv_思考":"90cf159733e558137ed20aa04d09964436f618a1.png","tv_恐吓":"0d15c7e2ee58e935adc6a7193ee042388adc22af.png"},
  enableQQ: true,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By Javen-Liu</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Let us make some noise <a href="https://jerryc.me/" target="_blank" rel="noopener">into the Matrix</a>!</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">簡</a><i class="darkmode far fa-moon" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@3/instantpage.min.js" type="module"></script></body></html>